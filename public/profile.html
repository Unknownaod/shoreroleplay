<!DOCTYPE html>
<html lang="en">
<head>
<title>Shore Roleplay | Profile</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:"Inter",sans-serif;
  background:url("https://i.imgur.com/vbt5BPF.jpeg") center/cover fixed;
  color:#fff;overflow-x:hidden;
}
a{color:#4ea3ff;text-decoration:none}

/* NAV */
nav{
  background:rgba(0,0,0,.55);
  backdrop-filter:blur(18px);
  border-bottom:1px solid rgba(255,255,255,.12);
  padding:18px 60px;
  display:flex;justify-content:space-between;align-items:center;
  position:fixed;top:0;width:100%;z-index:20;
}
nav a{margin-right:28px;font-size:15px;opacity:.85;cursor:pointer}
nav a:hover{color:#4ea3ff;text-shadow:0 0 12px #4ea3ff}

/* MAIN */
main{
  max-width:1100px;margin:150px auto 60px;
  background:rgba(0,0,0,.75);
  border-radius:14px;border:1px solid rgba(255,255,255,.11);
  box-shadow:0 0 45px rgba(0,0,0,.6);
  padding:40px;
}

/* PROFILE HEADER */
.profile-header{text-align:center;margin-bottom:30px}

/* PROFILE PICTURE */
.pfp-wrapper{
  width:160px;height:160px;border-radius:50%;
  overflow:hidden;margin:0 auto 20px;
  border:4px solid #4ea3ff;box-shadow:0 0 25px #4ea3ff70;
  display:flex;justify-content:center;align-items:center;
  background:#0d1117;font-size:3.5rem;font-weight:700;
  text-transform:uppercase;
}
.pfp-wrapper img{
  width:100%;height:100%;object-fit:cover;
}

/* STAFF BADGE BASE */
.staff-badge{
  padding:4px 10px;
  border-radius:6px;
  font-size:.78rem;
  font-weight:700;
  display:inline-block;
  margin-left:6px;
}

/* HEAD ADMIN BADGE — compact, white text, 3 down strikes */
.ha {
  position: relative;
  display: inline-block;

  background: #000;
  padding: 0px 10px 0px;   /* ↓ less height, same width */
  margin-left: 6px;
  border-radius: 3px;
  transform: skewX(-6deg);
  overflow: hidden;
  z-index: 2;

  font-style: italic;
  font-weight: 900;
  color: #ffffff;
  font-size: .82rem;
  letter-spacing: .7px;
  text-transform: uppercase;

  line-height: .72; /* ↓ compress text vertically */
}


/* LIGHTNING STRIKE AREA (spread horizontally) */
.ha svg.bolt {
  position: absolute;
  top: -100%;
  width: 10px;
  height: 260%;
  pointer-events: none;
  opacity: .9;
  z-index: 1;
}

/* left bolt */
.ha svg.bolt:nth-of-type(1) {
  left: 15%;        /* LEFT SIDE */
  transform: translateX(-50%);
}

/* center bolt */
.ha svg.bolt:nth-of-type(2) {
  left: 50%;        /* CENTER */
  transform: translateX(-50%);
  animation-delay: .25s;
}

/* right bolt */
.ha svg.bolt:nth-of-type(3) {
  left: 85%;        /* RIGHT SIDE */
  transform: translateX(-50%);
  animation-delay: .55s;
}


/* LIGHTNING LINES */
.ha svg.bolt polyline {
  fill: none;
  stroke: #ffffff;             /* pure white lightning */
  stroke-width: 2;
  stroke-linecap: round;
  stroke-linejoin: round;
  filter: drop-shadow(0 0 6px #ffffff);
  animation: strikeDown 1.4s linear infinite;
}

/* DOWNWARD MOTION */
@keyframes strikeDown {
  0%   { transform: translateY(-120%); opacity: 0; }
  12%  { opacity: 1; }
  40%  { transform: translateY(10%); }
  65%  { opacity: .7; }
  100% { transform: translateY(130%); opacity: 0; }
}

/* bolt offset timing */
.ha svg.bolt:nth-child(2) polyline { animation-delay: .25s; }
.ha svg.bolt:nth-child(3) polyline { animation-delay: .55s; }



/* -------------------------------------------
   OTHER ROLES (UNCHANGED)
------------------------------------------- */
.ia{background:#ff5050}
.adm{background:#3498db}
.jadm{background:#6741ff}
.sstaff{background:#ffaa00;color:#000}
.staff{background:#27ae60;color:#000}
.sit{background:#16a085}


/* SECTIONS */
.section{margin-top:45px}
.section h2{
  font-size:1.45rem;margin-bottom:16px;
  border-left:4px solid #4ea3ff;padding-left:10px;
}

/* INFO BOX */
.info-box{
  background:#0c111b;border:1px solid rgba(255,255,255,.14);
  padding:18px;margin:10px 0;border-radius:10px;
}

/* DEPARTMENTS */
.dept{
  display:flex;align-items:center;
  background:#111722;border:1px solid rgba(255,255,255,.14);
  padding:14px 18px;margin:8px 0;border-radius:10px;
}
.dept img{
  width:52px;height:52px;margin-right:18px;
}

/* APPLICATIONS */
.app-card{
  background:#0b1019;border:1px solid rgba(255,255,255,.12);
  border-radius:10px;padding:14px;margin:8px 0;font-size:.95rem;
}
.badge{padding:4px 10px;border-radius:6px;font-size:.78rem;font-weight:600}
.accepted{background:#2ecc71;color:#000}
.denied{background:#ff4f4f;color:#000}
.pending{background:#f1c40f;color:#000}

footer{text-align:center;margin-top:50px;opacity:.6;padding:20px;font-size:.9rem}
</style>
</head>
<body>

<nav>
  <div>
    <a href="index.html">Home</a>
    <a href="departments.html">Departments</a>
    <a href="rules.html">Rules</a>
    <a href="apply.html">Apply</a>
    <a href="forums.html">Forums</a>
  </div>
</nav>

<main>
  <div class="profile-header">
    <div id="pfp" class="pfp-wrapper"></div>
    <h1 id="username">Loading...</h1>
    <p id="subtitle"></p>
    <p id="bio" style="margin-top:10px;max-width:700px;margin:auto;opacity:.9;font-size:.95rem"></p>
  </div>

  <div class="section">
    <h2>Account Information</h2>
    <div id="infoBox" class="info-box">Loading...</div>
  </div>

  <div class="section">
    <h2>Departments</h2>
    <div id="deptList"></div>
  </div>

  <div class="section">
    <h2>Public Applications</h2>
    <div id="appsList"></div>
  </div>
</main>

<footer>© 2025 Shore Roleplay — All Rights Reserved</footer>

<script>
const API = "https://shoreroleplay.onrender.com";
const params = new URLSearchParams(window.location.search);
const profileUsername = params.get("user");
if (!profileUsername) location.href = "index.html";

/* STAFF ROLE COLORS */
const roleColor = {
  "Head Administrator": "ha",
  "Internal Affairs": "ia",
  "Administration": "adm",
  "Junior Administration": "jadm",
  "Senior Staff": "sstaff",
  "Staff": "staff",
  "Staff In Training": "sit",
};

/* DEPT ICONS */
const deptIcons = {
  "Police Department": "https://i.imgur.com/3Uhtndq.png",
  "State Police": "https://i.imgur.com/24jUZlT.png",
  "Sheriff's Office": "https://i.imgur.com/3Uhtndq.png",
  "Fire Department": "https://i.imgur.com/cgD0S1f.png",
  "Communications": "https://i.imgur.com/Saa1GSc.png",
  "Civilian Operations": "https://i.imgur.com/bh07jkF.png",
};

const ADMIN_ROLES = [
  "Head Administrator",
  "Internal Affairs",
  "Administration",
];

/* ============================================
   LOAD PROFILE
============================================ */
async function loadProfile() {
  const users = await fetch(`${API}/users`).then((r) => r.json());
  const u = users.find(
    (x) => x.username.toLowerCase() === profileUsername.toLowerCase()
  );

  if (!u) {
    document.getElementById("username").textContent = "User Not Found";
    return;
  }

  /* USERNAME */
  document.getElementById("username").textContent = u.username;

/* STAFF BADGE OR NORMAL */
const sub = document.getElementById("subtitle");

if (u.role === "Head Administrator") {
  sub.innerHTML = `
    Staff Member —
<span class="ha">
  ${u.role}

  <svg class="bolt" viewBox="0 0 14 80">
    <polyline points="7,0 6,18 9,36 5,52 8,70" />
  </svg>

  <svg class="bolt" viewBox="0 0 14 80">
    <polyline points="3,0 4,26 2,48 5,74" />
  </svg>

  <svg class="bolt" viewBox="0 0 14 80">
    <polyline points="11,0 10,22 12,46 9,70" />
  </svg>
</span>
  `;
} else if (u.role !== "user") {
  sub.innerHTML = `Staff Member — <span class="staff-badge ${roleColor[u.role]}">${u.role}</span>`;
} else {
  sub.textContent = "Shore Roleplay Member";
}





  /* BIO */
  document.getElementById("bio").textContent = u.bio || "";

  /* PROFILE PICTURE */
  const pfp = document.getElementById("pfp");
  if (u.pfp) {
    pfp.innerHTML = `<img src="${u.pfp}">`;
  } else {
    const letter = u.username[0].toUpperCase();
    pfp.textContent = letter;
  }

  /* ACCOUNT INFO */
  document.getElementById("infoBox").innerHTML = `
    <strong>Username:</strong> ${u.username}<br>
    <strong>Role:</strong> ${u.role}<br>
    <strong>Joined:</strong> ${new Date(u.createdAt).toLocaleDateString()}
  `;

  /* ============================================
     APPLICATIONS - FIXED ENDPOINT
  ============================================= */
  const apps = await fetch(`${API}/applications/user/${u.email}`).then((r) =>
    r.json()
  );
  const appsList = document.getElementById("appsList");

  apps.forEach((app) => {
    appsList.innerHTML += `
      <div class="app-card">
        <strong>${app.department}</strong> — ${new Date(
          app.submittedAt
        ).toLocaleDateString()}
        <div class="badge ${app.status}">${app.status.toUpperCase()}</div>
      </div>`;
  });

  /* ============================================
     DEPARTMENTS BASED ON ACCEPTED APPLICATIONS
  ============================================= */
  const dept = document.getElementById("deptList");

  if (ADMIN_ROLES.includes(u.role)) {
    // Staff see all departments
    Object.keys(deptIcons).forEach((d) => {
      dept.innerHTML += `
      <div class="dept">
        <img src="${deptIcons[d]}">
        <div><strong>${d}</strong><br>Administrative Access</div>
      </div>`;
    });
  } else {
    // Regular users see their accepted departments
    const accepted = apps.filter((a) => a.status === "accepted");

    if (!accepted.length) {
      dept.innerHTML = "<p>No accepted departments.</p>";
    }

    accepted.forEach((app) => {
      dept.innerHTML += `
      <div class="dept">
        <img src="${deptIcons[app.department]}">
        <div><strong>${app.department}</strong><br>Active Department Member</div>
      </div>`;
    });
  }
}

loadProfile();

</script>

</body>
</html>
