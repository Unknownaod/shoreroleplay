<!DOCTYPE html>
<html lang="en">
<head>
  <title>Shore Roleplay | Staff Panel</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{background:#05070a;color:#fff;font-family:"Segoe UI",sans-serif;}

    nav{
      padding:18px 55px;
      display:flex;justify-content:space-between;align-items:center;
      background:rgba(0,0,0,.35);backdrop-filter:blur(14px);
      border-bottom:1px solid rgba(255,255,255,.1);
      position:fixed;top:0;width:100%;z-index:1000;
    }
    nav a{color:#fff;text-decoration:none;font-size:15px;margin-right:30px;}
    nav a:hover{color:#4EA3FF;text-shadow:0 0 10px #4EA3FF;}

    header{padding-top:120px;text-align:center;}
    header h1{font-size:3rem;margin-bottom:10px;text-shadow:0 0 20px rgba(0,0,0,.6);}
    header p{opacity:.7;}

    .login-box{
      max-width:420px;margin:120px auto;background:#0c0f16;
      padding:32px;border:1px solid rgba(255,255,255,.08);border-radius:10px;
      text-align:center;
    }
    .login-box input{
      width:100%;padding:14px;font-size:16px;
      border-radius:8px;border:1px solid rgba(255,255,255,.18);
      background:#11151f;color:#fff;margin-top:12px;
    }
    .login-box button{
      margin-top:18px;width:100%;padding:14px;
      background:#4EA3FF;border:none;border-radius:8px;
      color:#fff;font-size:17px;font-weight:600;
      transition:.25s;cursor:pointer;
    }
    .login-box button:hover{transform:scale(1.03);box-shadow:0 0 18px #4EA3FF;}

    .panel{
      display:none; /* Hidden until authenticated */
      max-width:1100px;margin:50px auto;background:#090c12;
      padding:35px;border-radius:12px;border:1px solid rgba(255,255,255,.06);
    }

    table{width:100%;border-collapse:collapse;margin-top:18px;}
    th,td{padding:14px;border-bottom:1px solid rgba(255,255,255,.08)}
    th{color:#4EA3FF}

    .btn{
      padding:7px 14px;border-radius:6px;font-size:14px;
      cursor:pointer;border:none;transition:.2s;
    }
    .accept{background:#2ecc71;border:1px solid #1e9d55;}
    .deny{background:#e74c3c;border:1px solid #b23127;}
    .accept:hover{background:#45ed8a}
    .deny:hover{background:#ff6a5e}

    .status{padding:6px 10px;border-radius:6px;font-size:12px;font-weight:600;}
    .pending{background:#f1c40f33;color:#f1c40f}
    .accepted{background:#2ecc7133;color:#2ecc71}
    .denied{background:#e74c3c33;color:#e74c3c}

    footer{text-align:center;padding:28px;opacity:.6;margin-top:65px;}
  </style>
</head>
<body>

<nav>
  <div>
    <a href="/">Home</a>
    <span style="opacity:.55;">Staff Panel</span>
  </div>
  <a href="/" style="background:#4ea3ff;padding:10px 22px;border-radius:8px;">⬅ Back to Home</a>
</nav>

<header>
  <h1>Staff Operations</h1>
  <p>Restricted access — authorized personnel only</p>
</header>

<!-- LOGIN FORM -->
<div class="login-box" id="loginBox">
  <h2>Enter Staff Password</h2>
  <input id="staffPass" type="password" placeholder="Staff Password">
  <button onclick="login()">Access Panel</button>
  <p id="error" style="color:#ff5555;margin-top:10px;"></p>
</div>

<!-- STAFF PANEL -->
<div class="panel" id="panel">
  <table>
    <thead>
      <tr>
        <th>Username</th><th>Email</th><th>Department</th><th>Submitted</th><th>Status</th><th>Action</th>
      </tr>
    </thead>
    <tbody id="apps"></tbody>
  </table>
</div>

<footer>© Shore Roleplay — Staff Operations</footer>

<script>
const API = "https://shoreroleplay.onrender.com";

async function login() {
  const password = document.getElementById("staffPass").value;
  const error = document.getElementById("error");

  const res = await fetch(API + "/staff-auth", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ password })
  });

  if (res.ok) {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("panel").style.display = "block";
    loadApps();
  } else {
    error.textContent = "❌ Incorrect password";
  }
}

async function loadApps() {
  const res = await fetch(API + "/applications");
  const data = await res.json();
  const tbody = document.getElementById("apps");

  tbody.innerHTML = data.map(app => `
    <tr>
      <td>${app.username}</td>
      <td>${app.email}</td>
      <td>${app.department || "N/A"}</td>
      <td>${app.date}</td>
      <td><span class="status ${app.status}">${app.status.toUpperCase()}</span></td>
      <td>
        <button class="btn accept" onclick="decide('${app.id}','accepted')">Accept</button>
        <button class="btn deny" onclick="decide('${app.id}','denied')">Deny</button>
      </td>
    </tr>
  `).join("");
}

async function decide(id, status) {
  if (!confirm(`Confirm marking this application as ${status}?`)) return;
  await fetch(`${API}/applications/${id}/decision`, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ status })
  });
  alert("Decision saved & applicant notified!");
  loadApps();
}
</script>

</body>
</html>
